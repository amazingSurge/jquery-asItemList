/*! asItemList - v0.1.0 - 2014-05-27
* https://github.com/amazingsurge/jquery-asItemList
* Copyright (c) 2014 amazingSurge; Licensed MIT */
(function(t,e,s,i){"use strict";var n="asItemList",a={namespace:"asItemList",name:null,sortableID:"asItemList-sortable",itemList:function(){return'<div class="namespace-container"><a class="namespace-addItem"><i></i>Add new list</a><ul class="namespace-list"></ul></div>'},render:function(){},process:function(t){return t?JSON.stringify(t):""},parse:function(e){return e?t.parseJSON(e):null},onInit:null,onReady:null,onAdd:null,onEdit:null,onAfterFill:null},r=t[n]=function(e,s){this.element=e,this.$element=t(e),this.name=this.$element.attr("name")?this.$element.attr("name"):s.name,this.options=t.extend({},a,s,this.$element.data()),this._plugin=n,this.namespace=this.options.namespace,this.classes={disabled:this.namespace+"_disabled",wrapper:this.namespace+"-wrapper",active:this.namespace+"_active",hide:this.namespace+"_hide",hover:this.namespace+"_hover"},this.$element.addClass(this.namespace),this.$element.wrap('<div class="'+this.classes.wrapper+'"></div>'),this.$wrapper=this.$element.parent(),this.$itemList=t(this.options.itemList().replace(/namespace/g,this.namespace)),this.$addItem=this.$itemList.find("."+this.namespace+"-addItem"),this.$list=this.$itemList.find("."+this.namespace+"-list"),this.$list.attr("id",this.options.sortableID),this.disabled=!1,this.initialized=!1,this._trigger("init"),this.init()};r.prototype={constructor:r,init:function(){var s=this;this.$element.hide(),this.$element.before(this.$itemList),this._getList(),this.$addItem.on("click",function(){s._trigger("add")});var i=e.getElementById(this.options.sortableID);this.$list.on("click","li",t.proxy(function(t){this._trigger("edit",t.currentTarget)},this)).on("mouseenter","li",t.proxy(function(e){t(e.currentTarget).addClass(this.classes.hover)},this)).on("mouseleave","li",t.proxy(function(e){t(e.currentTarget).removeClass(this.classes.hover)},this)).on("mouseenter","."+this.namespace+"-drag",t.proxy(function(){this.sort=new Sortable(i,{onUpdate:function(e){var i=t(e.item).data("index"),n=s.value.splice(i,1);s.value.splice(t(e.item).index(),0,n[0]),s.$element.val(s.options.process(s.value)),s.sort.destroy()}})},this)).on("mouseleave","."+this.namespace+"-drag",t.proxy(function(){this.sort.destroy()},this)).on("click","."+this.namespace+"-delete",t.proxy(function(e){return this.delete(t(e.currentTarget).parent().index()),!1},this))},_getList:function(){var t=this.$element.val();this.value=t?this.options.parse(t):{},this.value.length>0?(this.$list.html(""),this._showList()):this.$list.html("<li>There is no item</li>")},_showList:function(){this.$list.data("scroll")!==i&&this.$list.asScrollable("destory");for(var e,s=0;e=this.value[s];s++)t("<li/>",{html:'<span class="'+this.namespace+'-drag"></span>'+'<div class="'+this.namespace+'-item">'+this.options.render(e)+"</div>"+'<a href="#" class="'+this.namespace+'-delete"></a>'}).data("index",s).appendTo(this.$list)},_trigger:function(t){this.$element.trigger("asItemList::"+t,this),this.$element.trigger(t+".asItemList",this),t=t.replace(/\b\w+\b/g,function(t){return t.substring(0,1).toUpperCase()+t.substring(1)});var e="on"+t,s=arguments.length>1?Array.prototype.slice.call(arguments,1):i;"function"==typeof this.options[e]&&this.options[e].apply(this,s)},"delete":function(t){this.value.splice(t,1),this.$element.val(this.options.process(this.value)),this._getList()},add:function(t){t=this.options.parse(t),this.value.push(t),this.$element.val(this.options.process(this.value)),this._getList()},update:function(){this._getList()},get:function(){var t=this.$element.val();return 0===this.value.length&&(t=null),t},enable:function(){this.disabled=!1,this.$wrapper.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrapper.addClass(this.classes.disabled)},destory:function(){this.$element.data(n,null),this._trigger("destory")}},r.defaults=a,t.fn[n]=function(e){if("string"!=typeof e)return this.each(function(){t.data(this,n)||t.data(this,n,new r(this,e))});var s=e,a=arguments.length>1?Array.prototype.slice.call(arguments,1):i;if(/^\_/.test(s))return!1;if(!(/^(get)$/.test(s)||"val"===s&&a===i))return this.each(function(){var e=t.data(this,n);e&&"function"==typeof e[s]&&e[s].apply(e,a)});var l=this.first().data(n);return l&&"function"==typeof l[s]?l[s].apply(l,a):i}})(jQuery,document,window);