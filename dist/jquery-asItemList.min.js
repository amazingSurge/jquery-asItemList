/*! asItemList - v0.1.0 - 2014-09-06
* https://github.com/amazingSurge/jquery-asItemList
* Copyright (c) 2014 amazingSurge; Licensed MIT */
!function(a,b,c,d){"use strict";var e="asItemList",f={namespace:"asItemList",sortableID:"asItemList-sortable",leng:"en",itemList:function(){return'<div class="namespace-container"><a class="namespace-addItem"><i></i>{{strings.addTitle}}</a><ul class="namespace-list"></ul><div class="namespace-prompt">{{strings.prompt}}</div></div>'},render:function(a){return a},process:function(a){if(a){var b=JSON.stringify(a);return"[]"===b?"":b}return""},parse:function(a){return a?c.parseJSON(a):null},onInit:null,onReady:null,onAdd:null,onEdit:null,onAfterFill:null},g=c[e]=function(a,b){this.element=a,this.$element=c(a),this.options=c.extend({},f,b,this.$element.data()),this.lang="undefined"==typeof g.Strings[this.options.lang]?"en":this.options.lang,this.strings=c.extend({},g.Strings[this.lang],this.options.strings),this._plugin=e,this.namespace=this.options.namespace,this.classes={disabled:this.namespace+"_disabled",wrapper:this.namespace+"-wrapper",active:this.namespace+"_active",empty:this.namespace+"_empty",hide:this.namespace+"_hide",hover:this.namespace+"_hover"},this.$element.addClass(this.namespace),this.$element.wrap('<div class="'+this.classes.wrapper+'"></div>'),this.$wrapper=this.$element.parent(),this.$itemList=c(this.options.itemList().replace(/namespace/g,this.namespace).replace(/\{\{strings.addTitle\}\}/g,this.strings.addTitle).replace(/\{\{strings.prompt\}\}/g,this.strings.prompt)),this.$addItem=this.$itemList.find("."+this.namespace+"-addItem"),this.$prompt=this.$itemList.find("."+this.namespace+"-prompt"),this.$list=this.$itemList.find("."+this.namespace+"-list"),this.$list.attr("id",this.options.sortableID),this.disabled=!1,this.initialized=!1,this._trigger("init"),this.init()};g.prototype={constructor:g,init:function(){var a=this;this.$element.hide(),this.$element.before(this.$itemList),this.value=this.options.parse(this.$element.val()),this.set(this.value,!1),this.$addItem.on("click",function(){a._trigger("add")});var e=b.getElementById(this.options.sortableID);this.$list.on("click","li",c.proxy(function(a){this.editIndex=c(a.currentTarget).index(),this._trigger("edit",this.editIndex)},this)).on("mouseenter","li",c.proxy(function(a){c(a.currentTarget).addClass(this.classes.hover)},this)).on("mouseleave","li",c.proxy(function(a){c(a.currentTarget).removeClass(this.classes.hover)},this)).on("mouseenter","."+this.namespace+"-list-drag",c.proxy(function(b){this.sortIndex=c(b.currentTarget).parent().index(),this.sort=new d(e,{onUpdate:function(b){var d=a.value.splice(a.sortIndex,1);a.value.splice(c(b.item).index(),0,d[0]),a.$element.val(a.options.process(a.value)),a.sort.destroy()}})},this)).on("mouseleave","."+this.namespace+"-list-drag",c.proxy(function(){this.sort.destroy()},this)).on("click","."+this.namespace+"-list-remove",c.proxy(function(a){return this.indexed=c(a.currentTarget).parent().index(),this.remove(this.indexed),!1},this))},_update:function(){this.$element.val(this.val()),this._trigger("change",this.value,this.options.name,e)},_updateList:function(){if(this.value.length>this.$list.children().length)this._addList();else if(this.value.length===this.$list.children().length&&0!==this.value.length){var a=this.value[this.editIndex];this.$list.children().eq(this.editIndex).html(this._editList(a))}else 0===this.value.length&&this.$wrapper.addClass(this.classes.empty),this._delList()},_editList:function(a){return'<span class="'+this.namespace+'-list-drag"></span><div class="'+this.namespace+'-list-item">'+this.options.render(a)+'</div><a href="#" class="'+this.namespace+'-list-remove"></a>'},_addList:function(){this.$wrapper.removeClass(this.classes.empty);for(var a,b=this.$list.children().length;b<this.value.length;b++)a=this.value[b],c("<li/>",{html:this._editList(a)}).appendTo(this.$list)},_delList:function(){this.$list.children().eq(this.indexed).remove()},_clearList:function(){this.$list.children().remove()},_trigger:function(a){var b=Array.prototype.slice.call(arguments,1),c=[this].concat(b);this.$element.trigger("asItemList::"+a,c),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var d="on"+a;"function"==typeof this.options[d]&&this.options[d].apply(this,b)},val:function(a){if("undefined"==typeof a)return this.options.process(this.value);var b=this.options.parse(a);b?this.set(b):this.clear()},set:function(a,b){this.value=c.isArray(a)?a:[],this._clearList(),this._updateList(),b!==!1&&this._update()},clear:function(a){this.value=[],this._clearList(),this.$wrapper.addClass(this.classes.empty),a!==!1&&this._update()},remove:function(a,b){this.value.splice(a,1),this._updateList(),b!==!1&&this._update()},add:function(a,b){for(var c in a)this.value.push(a[c]);this._updateList(),b!==!1&&this._update()},update:function(a,b,c){this.value[a]=b,this._updateList(),c!==!1&&this._update()},get:function(){return this.value},enable:function(){this.disabled=!1,this.$wrapper.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrapper.addClass(this.classes.disabled)},destory:function(){this.$element.data(e,null),this._trigger("destory")}},g.defaults=f,g.Strings={},g.localize=function(a,b){g.Strings[a]=b},g.localize("en",{addTitle:"Add new list",prompt:"There is no item"}),c.fn[e]=function(a){if("string"!=typeof a)return this.each(function(){c.data(this,e)||c.data(this,e,new g(this,a))});var b=a,d=Array.prototype.slice.call(arguments,1);if(/^\_/.test(b))return!1;if(!(/^(get)$/.test(b)||"val"===b&&0===d.length))return this.each(function(){var a=c.data(this,e);a&&"function"==typeof a[b]&&a[b].apply(a,d)});var f=this.first().data(e);return f&&"function"==typeof f[b]?f[b].apply(f,d):void 0}}(window,document,jQuery,function(){"use strict";return void 0===Sortable?!1:Sortable}());