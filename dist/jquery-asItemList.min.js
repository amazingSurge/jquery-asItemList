/**
* jQuery asItemList
* a jquery plugin
* Compiled: Thu Aug 18 2016 15:40:40 GMT+0800 (CST)
* @version v0.1.1
* @link https://github.com/amazingSurge/jquery-asItemList
* @copyright LGPL-3.0
*/
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","jQuery","Sortable"],t);else if("undefined"!=typeof exports)t(exports,require("jQuery"),require("Sortable"));else{var i={exports:{}};t(i.exports,e.jQuery,e.Sortable),e.jqueryAsItemList=i.exports}}(this,function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=s(t),r=s(i),l=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),u={namespace:"",sortableID:"asItemList-sortable",leng:"en",itemList:function(){return'<div class="namespace-container"><a class="namespace-addItem"><i></i>{{strings.addTitle}}</a><ul class="namespace-list"></ul><div class="namespace-prompt">{{strings.prompt}}</div></div>'},render:function(e){return e},process:function(e){if(e){var t=JSON.stringify(e);return"[]"===t?"":t}return""},parse:function(e){return e?$.parseJSON(e):null},onInit:null,onReady:null,onAdd:null,onEdit:null,onAfterFill:null},h="asItemList";u.namespace=h;var o=function(){function e(t,i){n(this,e),this.element=t,this.$element=(0,a.default)(t),this.options=a.default.extend({},u,i,this.$element.data()),"undefined"==typeof e.Strings[this.options.lang]?this.lang="en":this.lang=this.options.lang,this.strings=a.default.extend({},e.Strings[this.lang],this.options.strings),this._plugin=h,this.namespace=this.options.namespace,this.classes={disabled:this.namespace+"_disabled",wrapper:this.namespace+"-wrapper",active:this.namespace+"_active",empty:this.namespace+"_empty",hide:this.namespace+"_hide",hover:this.namespace+"_hover"},this.$element.addClass(this.namespace),this.$element.wrap('<div class="'+this.classes.wrapper+'"></div>'),this.$wrapper=this.$element.parent(),this.$itemList=(0,a.default)(this.options.itemList().replace(/namespace/g,this.namespace).replace(/\{\{strings.addTitle\}\}/g,this.strings.addTitle).replace(/\{\{strings.prompt\}\}/g,this.strings.prompt)),this.$addItem=this.$itemList.find("."+this.namespace+"-addItem"),this.$prompt=this.$itemList.find("."+this.namespace+"-prompt"),this.$list=this.$itemList.find("."+this.namespace+"-list"),this.$list.attr("id",this.options.sortableID),this.disabled=!1,this.initialized=!1,this._trigger("init"),this.init()}return l(e,[{key:"init",value:function(){var e=this;this.$element.hide(),this.$element.before(this.$itemList),this.value=this.options.parse(this.$element.val()),this.set(this.value,!1),this.$addItem.on("click",function(){e._trigger("add")});var t=document.getElementById(this.options.sortableID);this.$list.on("click","li",a.default.proxy(function(e){this.editIndex=(0,a.default)(e.currentTarget).index(),this._trigger("edit",this.editIndex)},this)).on("mouseenter","li",a.default.proxy(function(e){(0,a.default)(e.currentTarget).addClass(this.classes.hover)},this)).on("mouseleave","li",a.default.proxy(function(e){(0,a.default)(e.currentTarget).removeClass(this.classes.hover)},this)).on("mouseenter","."+this.namespace+"-list-drag",a.default.proxy(function(i){this.sortIndex=(0,a.default)(i.currentTarget).parent().index(),this.sort=new r.default(t,{onUpdate:function(t){var i=e.value.splice(e.sortIndex,1);e.value.splice((0,a.default)(t.item).index(),0,i[0]),e.$element.val(e.options.process(e.value)),e.sort.destroy()}})},this)).on("mouseleave","."+this.namespace+"-list-drag",a.default.proxy(function(){this.sort.destroy()},this)).on("click","."+this.namespace+"-list-remove",a.default.proxy(function(e){return this.indexed=(0,a.default)(e.currentTarget).parent().index(),this.remove(this.indexed),!1},this))}},{key:"_update",value:function(){this.$element.val(this.val()),this._trigger("change",this.value,this.options.name,h)}},{key:"_updateList",value:function(){if(this.value.length>this.$list.children().length)this._addList();else if(this.value.length===this.$list.children().length&&0!==this.value.length){var e=this.value[this.editIndex];this.$list.children().eq(this.editIndex).html(this._editList(e))}else 0===this.value.length&&this.$wrapper.addClass(this.classes.empty),this._delList()}},{key:"_editList",value:function(e){return'<span class="'+this.namespace+'-list-drag"></span><div class="'+this.namespace+'-list-item">'+this.options.render(e)+'</div><a href="#" class="'+this.namespace+'-list-remove"></a>'}},{key:"_addList",value:function(){this.$wrapper.removeClass(this.classes.empty);for(var e,t=this.$list.children().length;t<this.value.length;t++)e=this.value[t],(0,a.default)("<li/>",{html:this._editList(e)}).appendTo(this.$list)}},{key:"_delList",value:function(){this.$list.children().eq(this.indexed).remove()}},{key:"_clearList",value:function(){this.$list.children().remove()}},{key:"_trigger",value:function(e){var t=Array.prototype.slice.call(arguments,1),i=[this].concat(t);this.$element.trigger("asItemList::"+e,i),e=e.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)});var s="on"+e;"function"==typeof this.options[s]&&this.options[s].apply(this,t)}},{key:"val",value:function(e){if("undefined"==typeof e)return this.options.process(this.value);var t=this.options.parse(e);t?this.set(t):this.clear()}},{key:"set",value:function(e,t){a.default.isArray(e)?this.value=e:this.value=[],this._clearList(),this._updateList(),t!==!1&&this._update()}},{key:"clear",value:function(e){this.value=[],this._clearList(),this.$wrapper.addClass(this.classes.empty),e!==!1&&this._update()}},{key:"remove",value:function(e,t){this.value.splice(e,1),this._updateList(),t!==!1&&this._update()}},{key:"add",value:function(e,t){for(var i in e)this.value.push(e[i]);this._updateList(),t!==!1&&this._update()}},{key:"update",value:function(e,t,i){this.value[e]=t,this._updateList(),i!==!1&&this._update()}},{key:"get",value:function(){return this.value}},{key:"enable",value:function(){this.disabled=!1,this.$wrapper.removeClass(this.classes.disabled)}},{key:"disable",value:function(){this.disabled=!0,this.$wrapper.addClass(this.classes.disabled)}},{key:"destory",value:function(){this.$element.data(h,null),this._trigger("destory")}}],[{key:"_jQueryInterface",value:function(t){for(var i=arguments.length,s=Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];if("string"!=typeof t)return this.each(function(){a.default.data(this,h)||a.default.data(this,h,new e(this,t))});if(/^\_/.test(t))return!1;if(!(/^(get)$/.test(t)||"val"===t&&0===s.length))return this.each(function(){var e=a.default.data(this,h);e&&"function"==typeof e[t]&&e[t].apply(e,s)});var r=this.first().data(h);return r&&"function"==typeof r[t]?r[t].apply(r,s):void 0}}]),e}();o.defaults=u,o.Strings={},o.localize=function(e,t){o.Strings[e]=t},o.localize("en",{addTitle:"Add new list",prompt:"There is no item"}),a.default.fn[h]=o._jQueryInterface,a.default.fn[h].constructor=o,a.default.fn[h].noConflict=function(){return a.default.fn[h]=window.JQUERY_NO_CONFLICT,o._jQueryInterface},e.default=o});