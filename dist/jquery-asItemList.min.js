/*! asItemList - v0.1.0 - 2014-07-04
* https://github.com/amazingsurge/jquery-asItemList
* Copyright (c) 2014 amazingSurge; Licensed MIT */
!function(a,b,c,d,e){"use strict";var f="asItemList",g={namespace:"asItemList",sortableID:"asItemList-sortable",itemList:function(){return'<div class="namespace-container"><a class="namespace-addItem"><i></i>Add new list</a><ul class="namespace-list"></ul></div>'},render:function(){},process:function(a){if(a){var b=JSON.stringify(a);return"[]"===b?"":b}return""},parse:function(a){return a?c.parseJSON(a):null},onInit:null,onReady:null,onAdd:null,onEdit:null,onAfterFill:null},h=c[f]=function(a,b){this.element=a,this.$element=c(a),this.options=c.extend({},g,b,this.$element.data()),this._plugin=f,this.namespace=this.options.namespace,this.classes={disabled:this.namespace+"_disabled",wrapper:this.namespace+"-wrapper",active:this.namespace+"_active",hide:this.namespace+"_hide",hover:this.namespace+"_hover"},this.$element.addClass(this.namespace),this.$element.wrap('<div class="'+this.classes.wrapper+'"></div>'),this.$wrapper=this.$element.parent(),this.$itemList=c(this.options.itemList().replace(/namespace/g,this.namespace)),this.$addItem=this.$itemList.find("."+this.namespace+"-addItem"),this.$list=this.$itemList.find("."+this.namespace+"-list"),this.$list.attr("id",this.options.sortableID),this.disabled=!1,this.initialized=!1,this._trigger("init"),this.init()};h.prototype={constructor:h,init:function(){var a=this;this.$element.hide(),this.$element.before(this.$itemList),this.value=this.options.parse(this.$element.val()),this.set(this.value,!1),this._updateList(),this.$addItem.on("click",function(){a._trigger("add")});var e=b.getElementById(this.options.sortableID);this.$list.on("click","li",c.proxy(function(a){this._trigger("edit",c(a.currentTarget).data("index"))},this)).on("mouseenter","li",c.proxy(function(a){c(a.currentTarget).addClass(this.classes.hover)},this)).on("mouseleave","li",c.proxy(function(a){c(a.currentTarget).removeClass(this.classes.hover)},this)).on("mouseenter","."+this.namespace+"-drag",c.proxy(function(){this.sort=new d(e,{onUpdate:function(b){var d=c(b.item).data("index"),e=a.value.splice(d,1);a.value.splice(c(b.item).index(),0,e[0]),a.$element.val(a.options.process(a.value)),a.sort.destroy()}})},this)).on("mouseleave","."+this.namespace+"-drag",c.proxy(function(){this.sort.destroy()},this)).on("click","."+this.namespace+"-remove",c.proxy(function(a){return this.remove(c(a.currentTarget).parent().index()),!1},this))},_update:function(){this._updateList(),this.$element.val(this.val()),this._trigger("change",this.val())},_updateList:function(){this.value.length>0?(this.$list.html(""),this._showList()):this.$list.html("<li>There is no item</li>")},_showList:function(){"undefined"!=typeof this.$list.data("scroll")&&this.$list.asScrollable("destory");for(var a,b=0;b<this.value.length;b++)a=this.value[b],c("<li/>",{html:'<span class="'+this.namespace+'-drag"></span><div class="'+this.namespace+'-item">'+this.options.render(a)+'</div><a href="#" class="'+this.namespace+'-remove"></a>'}).data("index",b).appendTo(this.$list)},_trigger:function(a){this.$element.trigger("asItemList::"+a,this),this.$element.trigger(a+".asItemList",this),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var b="on"+a,c=arguments.length>1?Array.prototype.slice.call(arguments,1):e;"function"==typeof this.options[b]&&this.options[b].apply(this,c)},val:function(a){if("undefined"==typeof a)return this.options.process(this.value);var b=this.options.parse(a);b?this.set(b):this.clear()},set:function(a,b){this.value=c.isArray(a)?a:[],b!==!1&&this._update()},clear:function(){this.value=[],this._update()},remove:function(a){this.value.splice(a,1),this._update()},add:function(a){this.value.push(a),this._update()},update:function(a,b){this.value[a]=b,this._update()},enable:function(){this.disabled=!1,this.$wrapper.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrapper.addClass(this.classes.disabled)},destory:function(){this.$element.data(f,null),this._trigger("destory")}},h.defaults=g,c.fn[f]=function(a){if("string"!=typeof a)return this.each(function(){c.data(this,f)||c.data(this,f,new h(this,a))});var b=a,d=arguments.length>1?Array.prototype.slice.call(arguments,1):e;if(/^\_/.test(b))return!1;if(!(/^(get)$/.test(b)||"val"===b&&d===e))return this.each(function(){var a=c.data(this,f);a&&"function"==typeof a[b]&&a[b].apply(a,d)});var g=this.first().data(f);return g&&"function"==typeof g[b]?g[b].apply(g,d):void 0}}(window,document,jQuery,function(){"use strict";return void 0===Sortable?!1:Sortable}());